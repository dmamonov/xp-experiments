Only in 5.8.0: gui
Only in 5.8.0: img
Only in 5.8.0: io
Only in 5.8.0: lang
Only in 5.8.0: peer
Only in 5.8.0: rdbms
Only in 5.8.0: remote
Only in 5.8.0: sapi
Only in 5.8.0: scriptlet
Only in 5.8.0: security
Only in src: .svn
Only in 5.8.0: text
Only in 5.8.0: unittest
Only in 5.8.0: util
Only in 5.8.0: VERSION
Only in 5.8.0/webservices: json
Only in 5.8.0/webservices/soap: CommonSoapFault.class.php
Only in 5.8.0/webservices/soap/interop: Round2BaseClient.class.php
Only in src/webservices/soap/interop: .svn
Only in 5.8.0/webservices/soap/native: NativeSoapClient.class.php
Only in src/webservices/soap/native: .svn
Only in 5.8.0/webservices/soap: Parameter.class.php
diff -ur '--exclude=\*.svn' 5.8.0/webservices/soap/rpc/SoapRpcRequest.class.php src/webservices/soap/rpc/SoapRpcRequest.class.php
--- 5.8.0/webservices/soap/rpc/SoapRpcRequest.class.php	2011-01-26 12:09:13.000000000 +0100
+++ src/webservices/soap/rpc/SoapRpcRequest.class.php	2011-01-26 12:55:03.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 /* This class is part of the XP framework
  *
- * $Id: SoapRpcRequest.class.php 12667 2008-12-02 16:12:00Z gelli $
+ * $Id: SoapRpcRequest.class.php 12249 2010-03-29 15:33:50Z gelli $
  */
  
   uses(
diff -ur '--exclude=\*.svn' 5.8.0/webservices/soap/rpc/SoapRpcResponse.class.php src/webservices/soap/rpc/SoapRpcResponse.class.php
--- 5.8.0/webservices/soap/rpc/SoapRpcResponse.class.php	2011-01-26 12:09:13.000000000 +0100
+++ src/webservices/soap/rpc/SoapRpcResponse.class.php	2011-01-26 12:55:03.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 /* This class is part of the XP framework
  *
- * $Id: SoapRpcResponse.class.php 13240 2009-07-20 07:40:50Z kiesel $
+ * $Id: SoapRpcResponse.class.php 12249 2010-03-29 15:33:50Z gelli $
  */
  
   uses('scriptlet.rpc.AbstractRpcResponse', 'peer.http.HttpConstants');
Only in 5.8.0/webservices/soap/rpc: SoapRpcRouter.class.php
Only in src/webservices/soap/rpc: .svn
Only in 5.8.0/webservices/soap: SoapDriver.class.php
diff -ur '--exclude=\*.svn' 5.8.0/webservices/soap/SOAPFaultException.class.php src/webservices/soap/SOAPFaultException.class.php
--- 5.8.0/webservices/soap/SOAPFaultException.class.php	2011-01-26 12:09:13.000000000 +0100
+++ src/webservices/soap/SOAPFaultException.class.php	2011-01-26 12:55:03.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 /* This class is part of the XP framework
  *
- * $Id: SOAPFaultException.class.php 10594 2007-06-11 10:04:54Z friebe $ 
+ * $Id: SOAPFaultException.class.php 12249 2010-03-29 15:33:50Z gelli $ 
  */
 
   /**
Only in src/webservices/soap: .svn
Only in 5.8.0/webservices/soap/transport: SOAPHTTPTransport.class.php
Only in src/webservices/soap/transport: .svn
diff -ur '--exclude=\*.svn' 5.8.0/webservices/soap/types/SOAPBase64Binary.class.php src/webservices/soap/types/SOAPBase64Binary.class.php
--- 5.8.0/webservices/soap/types/SOAPBase64Binary.class.php	2011-01-26 12:09:13.000000000 +0100
+++ src/webservices/soap/types/SOAPBase64Binary.class.php	2011-01-26 12:55:03.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 /* This class is part of the XP framework
  *
- * $Id: SOAPBase64Binary.class.php 10594 2007-06-11 10:04:54Z friebe $
+ * $Id: SOAPBase64Binary.class.php 12249 2010-03-29 15:33:50Z gelli $
  */
 
   uses('webservices.soap.types.SoapType');
Only in 5.8.0/webservices/soap/types: SOAPDateTime.class.php
diff -ur '--exclude=\*.svn' 5.8.0/webservices/soap/types/SOAPDecimal.class.php src/webservices/soap/types/SOAPDecimal.class.php
--- 5.8.0/webservices/soap/types/SOAPDecimal.class.php	2011-01-26 12:09:13.000000000 +0100
+++ src/webservices/soap/types/SOAPDecimal.class.php	2011-01-26 12:55:03.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 /* This class is part of the XP framework
  *
- * $Id: SOAPDecimal.class.php 13012 2009-04-28 04:50:01Z friebe $
+ * $Id: SOAPDecimal.class.php 12249 2010-03-29 15:33:50Z gelli $
  */
 
   uses('webservices.soap.types.SoapType');
diff -ur '--exclude=\*.svn' 5.8.0/webservices/soap/types/SOAPDouble.class.php src/webservices/soap/types/SOAPDouble.class.php
--- 5.8.0/webservices/soap/types/SOAPDouble.class.php	2011-01-26 12:09:13.000000000 +0100
+++ src/webservices/soap/types/SOAPDouble.class.php	2011-01-26 12:55:03.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 /* This class is part of the XP framework
  *
- * $Id: SOAPDouble.class.php 13012 2009-04-28 04:50:01Z friebe $
+ * $Id: SOAPDouble.class.php 12249 2010-03-29 15:33:50Z gelli $
  */
 
   uses('webservices.soap.types.SoapType');
Only in 5.8.0/webservices/soap/types: SOAPHashMap.class.php
diff -ur '--exclude=\*.svn' 5.8.0/webservices/soap/types/SOAPHexBinary.class.php src/webservices/soap/types/SOAPHexBinary.class.php
--- 5.8.0/webservices/soap/types/SOAPHexBinary.class.php	2011-01-26 12:09:13.000000000 +0100
+++ src/webservices/soap/types/SOAPHexBinary.class.php	2011-01-26 12:55:03.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 /* This class is part of the XP framework
  *
- * $Id: SOAPHexBinary.class.php 10594 2007-06-11 10:04:54Z friebe $
+ * $Id: SOAPHexBinary.class.php 12249 2010-03-29 15:33:50Z gelli $
  */
 
   uses('webservices.soap.types.SoapType');
diff -ur '--exclude=\*.svn' 5.8.0/webservices/soap/types/SOAPLong.class.php src/webservices/soap/types/SOAPLong.class.php
--- 5.8.0/webservices/soap/types/SOAPLong.class.php	2011-01-26 12:09:13.000000000 +0100
+++ src/webservices/soap/types/SOAPLong.class.php	2011-01-26 12:55:03.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 /* This class is part of the XP framework
  *
- * $Id: SOAPLong.class.php 8971 2006-12-27 15:27:10Z friebe $
+ * $Id: SOAPLong.class.php 12249 2010-03-29 15:33:50Z gelli $
  */
 
   uses('webservices.soap.types.SoapType');
diff -ur '--exclude=\*.svn' 5.8.0/webservices/soap/types/SoapType.class.php src/webservices/soap/types/SoapType.class.php
--- 5.8.0/webservices/soap/types/SoapType.class.php	2011-01-26 12:09:13.000000000 +0100
+++ src/webservices/soap/types/SoapType.class.php	2011-01-26 12:55:03.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 /* This class is part of the XP framework
  *
- * $Id: SoapType.class.php 10196 2007-05-04 10:56:54Z kiesel $ 
+ * $Id: SoapType.class.php 12249 2010-03-29 15:33:50Z gelli $ 
  */
 
   /**
Only in 5.8.0/webservices/soap/types: SOAPVector.class.php
Only in src/webservices/soap/types: .svn
Only in src/webservices/soap/xp: .svn
Only in 5.8.0/webservices/soap/xp: XPSoapClient.class.php
Only in 5.8.0/webservices/soap/xp: XPSoapHeader.class.php
diff -ur '--exclude=\*.svn' 5.8.0/webservices/soap/xp/XPSoapHeaderElement.class.php src/webservices/soap/xp/XPSoapHeaderElement.class.php
--- 5.8.0/webservices/soap/xp/XPSoapHeaderElement.class.php	2011-01-26 12:09:13.000000000 +0100
+++ src/webservices/soap/xp/XPSoapHeaderElement.class.php	2011-01-26 12:55:03.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 /* This class is part of the XP framework
  *
- * $Id: XPSoapHeaderElement.class.php 10015 2007-04-16 16:36:48Z kiesel $ 
+ * $Id: XPSoapHeaderElement.class.php 12249 2010-03-29 15:33:50Z gelli $ 
  */
 
   uses('webservices.soap.xp.XPSoapNode', 'webservices.soap.xp.XPSoapHeader');
Only in 5.8.0/webservices/soap/xp: XPSoapMapping.class.php
diff -ur '--exclude=\*.svn' 5.8.0/webservices/soap/xp/XPSoapMessage.class.php src/webservices/soap/xp/XPSoapMessage.class.php
--- 5.8.0/webservices/soap/xp/XPSoapMessage.class.php	2011-01-26 12:09:13.000000000 +0100
+++ src/webservices/soap/xp/XPSoapMessage.class.php	2011-01-26 13:01:30.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 /* This class is part of the XP framework
  *
- * $Id: XPSoapMessage.class.php 14822 2010-09-14 07:51:30Z friebe $
+ * $Id: XPSoapMessage.class.php 12636 2011-01-26 12:00:16Z olli $
  */
 
   uses(
@@ -168,6 +168,11 @@
       foreach (array_keys($node->children) as $i) {
         $this->body->children[0]->addChild($node->children[$i]);
       }
+
+      // Add all collected namespaces
+      foreach ($node->namespaces as $namespace => $identifier) {
+        $this->root->setAttribute('xmlns:'.$identifier, $namespace);
+      }
     }
 
     /**
@@ -252,7 +257,7 @@
             // Arrays of other types
             // ~~~~~~~~~~~~~~~~~~~~~
             // <item SOAP-ENC:arrayType="xsd:int[4]"/>
-            if ($this->namespaces[XMLNS_XP] == $ns) {
+            if (0 === strpos($ns, $this->namespaces[XMLNS_XP])) {
               $result= ArrayList::newInstance($length);              
               foreach ($this->_recurseData($child, FALSE, 'ARRAY') as $i => $val) {
                 $result[$i]= $val;
@@ -309,9 +314,10 @@
             // <item xmlns:xp="http://xp-framework.net/xmlns/xp" xsi:type="xp:de.schlund.db.irc.IrcChannel"/>        
             //
             // For other objects, check SOAPMapping registry
-            if (isset($this->namespaces[XMLNS_XP]) && $this->namespaces[XMLNS_XP] == $regs[1]) {
+            $ns = array_search($regs[1], $this->namespaces);
+            if (0 === strpos($ns, XMLNS_XP)) {
               try {
-                $xpclass= XPClass::forName($regs[2]);
+                $xpclass= XPClass::forName(substr($ns, strrpos($ns, '/')+ 1).'.'.$regs[2]);
               } catch (ClassNotFoundException $e) {
                 $xpclass= NULL;
               }
@@ -510,6 +516,7 @@
      */
     public function getFault() {
       if ($body= $this->_bodyElement()) {
+        $this->_retrieveNamespaces($body->children[0]);
         if (0 != strcasecmp(
           $body->children[0]->getName(), 
           $this->namespaces[XMLNS_SOAPENV].':Fault'
diff -ur '--exclude=\*.svn' 5.8.0/webservices/soap/xp/XPSoapNode.class.php src/webservices/soap/xp/XPSoapNode.class.php
--- 5.8.0/webservices/soap/xp/XPSoapNode.class.php	2011-01-26 12:09:13.000000000 +0100
+++ src/webservices/soap/xp/XPSoapNode.class.php	2011-01-26 13:01:30.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 /* This class is part of the XP framework
  *
- * $Id: XPSoapNode.class.php 14410 2010-03-24 15:25:17Z friebe $ 
+ * $Id: XPSoapNode.class.php 12636 2011-01-26 12:00:16Z olli $ 
  */
 
   uses(
@@ -20,7 +20,10 @@
   class XPSoapNode extends Node {
     public 
       $namespace= 'ctl';
-    
+
+    public
+      $namespaces= array();
+
     /**
      * Get type name by content
      *
@@ -111,6 +114,38 @@
     }
     
     /**
+     * Get namespace identfier for 
+     *
+     * @param   lang.Object obj
+     * @return  string
+     */
+    protected function namespaceIdentifierForObject($obj) {
+      $ns= 'http://xp-framework.net/xmlns/xp/'. $obj->getClass()->getPackage()->getName();
+
+      if (!isset($this->namespaces[$ns])) {
+        $this->namespaces[$ns]= 'ns'.(string)(sizeof($this->namespaces) + 1);
+      }
+     
+      return $this->namespaces[$ns];
+    }
+
+    /**
+     * (Insert method's description here)
+     *
+     * @param   
+     * @return  
+     */
+    protected function namespaceIdentifierForQname($qname) {
+      $ns= $qname->namespace;
+
+      if (!isset($this->namespaces[$ns])) {
+        $this->namespaces[$ns]= $qname->prefix ? $qname->prefix : 'ns'.(string)(sizeof($this->namespaces) + 1);
+      }
+      
+      return $this->namespaces[$ns];
+    }
+
+    /**
      * Marshaller
      *
      * @param   webservices.soap.xp.XPSoapNode child
@@ -174,38 +209,38 @@
         return;
       }
       
-      if (($value instanceof Generic) && NULL !== ($qname= $mapping->qnameFor($value->getClass()))) {
-        $ns++;
-        $child->attribute['xmlns:ns'.$ns]= $qname->namespace;
-        $child->attribute['xsi:type']= 'ns'.$ns.':'.$qname->localpart;
+      if (!$value instanceof Generic && is_object($value)) {  // Any other object, e.g. "stdClass"
+        $child->attribute['xmlns:php']= 'http://xp-framework.net/xmlns/php';
+        $child->attribute['xsi:type']= 'php:'.get_class($value);
+        $this->_recurse($child, get_object_vars($value), $mapping);
+        return;        
+      }
+
+      if (($value instanceof Generic) && $mapping && NULL !== ($qname= $mapping->qnameFor($value->getClass()))) {
+      
+        $nsid= $this->namespaceIdentifierForQname($qname);
+        $child->attribute['xmlns:'.$nsid]= $qname->namespace;
+        $child->attribute['xsi:type']= $nsid.':'.$qname->localpart;
         
         $this->_recurse($child, get_object_vars($value), $mapping);
         return;
       }
       
+      $nsid= $this->namespaceIdentifierForObject($value);
+      
       if ($value instanceof Collection) { // XP collection
         $child->attribute['xsi:type']= 'SOAP-ENC:Array';
-        $child->attribute['xmlns:xp']= 'http://xp-framework.net/xmlns/xp';
-        $child->attribute['SOAP-ENC:arrayType']= 'xp:'.$value->getElementClassName().'['.$value->size().']';
+        $child->attribute['SOAP-ENC:arrayType']= $nsid.':'.$value->getElementClassName().'['.$value->size().']';
         $this->_recurse($child, $value->values(), $mapping);
         return;
       }
       
       if ($value instanceof Generic) {     // XP objects
-        $child->attribute['xmlns:xp']= 'http://xp-framework.net/xmlns/xp';
-        $child->attribute['xsi:type']= 'xp:'.$value->getClassName();
+        $child->attribute['xsi:type']= $nsid.':'.$value->getClass()->getSimpleName();
         $this->_recurse($child, get_object_vars($value), $mapping);
         return;
       }
       
-      if (is_object($value)) {          // Any other object, e.g. "stdClass"
-        $ns++;
-        $child->attribute['xmlns:ns'.$ns]= 'http://xp-framework.net/xmlns/php';
-        $child->attribute['xsi:type']= 'ns'.$ns.':'.get_class($value);
-        $this->_recurse($child, get_object_vars($value), $mapping);
-        return;        
-      }
-      
       // Any other type is simply ignored
     }
     
Only in src/webservices: .svn
Only in 5.8.0/webservices: uddi
Only in 5.8.0/webservices: wddx
Only in 5.8.0/webservices: xmlrpc
Only in 5.8.0: xml
